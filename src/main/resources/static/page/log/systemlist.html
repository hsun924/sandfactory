<div id="test" data-toggle="context" data-target="#context-menu">
	<!-- 查询栏 -->
	<!--
  时间筛选：
      startTime:  yy-MM-dd
      endTime： yy-MM-dd
      （后台自动处理了时分秒）
  日志类型： action  1-登录 2-退出 操作日志：3-人员管理 4-角色管理',
  search: 关键字搜索  日志内容模糊查询
  -->


	<div class="panel panel-default searchPanel">
		<div class="panel-body">
			<form class="form-inline" role="form">
				<div class="form-group">
					<input type="text" class="form-control input-sm" id="roleName" placeholder="请输入角色名称">
				</div>
				<div class="form-group">
					<input type="text" class="form-control input-sm" id="roleNote" placeholder="请输入角色备注">
				</div>
				<button type="button" id="searchBtn" class="btn btn-default btn-sm">搜索</button>
				<button type="button" id="addBtn" class="btn btn-default btn-sm">添加</button>
			</form>
		</div>
	</div>

	<!-- 表格栏 -->
	<table id="example" class="table table-striped table-bordered" border="0" cellspacing="0" width="100%">
		<thead>
		<tr>
			<td>操作者</td>
			<td>IP</td>
			<td>操作类型</td>
			<td>操作时间</td>
			<td>操作内容</td>
		</tr>
		</thead>
	</table>
</div>

<script type="text/javascript">

	var roleAddDialog;
	var loadingDialog;

	function checkRow(cb, event) {
		event.stopPropagation();
		var checked = $(cb).prop("checked");
		if(checked) {
			$(cb).parent().parent().addClass('selected');
			var cascadeAll = true;
			$("#example").find("input[name='id_checkbox']").each(function(){
				if(!$(this).prop("checked")) {
					cascadeAll = false;
					return;
				}
			});
			if(cascadeAll) {
				$("#checkAll").prop("checked",true);
			}
		} else {
			$(cb).parent().parent().removeClass('selected');
			$("#checkAll").prop("checked",false);
		}
	}

	$(function() {

		//输入框placeholder的IE兼容处理
		placeholder();
		var tableHeight = calcDataTablesHeight($(".dashbord-main"), $(".searchPanel"));
		var roleTable = $('#example').dataTable({
			scrollY : tableHeight,
			ajax : "/systemlog/list",
			columns : [{
				data : "managerName"
			}, {
				data : "managerIp"
			}, {
				data : "action"
			}, {
				data : "time"//票据编号
			}, {
				data : "content" //车辆号码
			}],
			ordering:false,
			fnDrawCallback: function(oSettings) {
				$("#checkAll").prop("checked",false);
			}
		});

		function detailInfo(full) {
			alert(full.id);
		}


		$('#example tbody').on( 'click', 'tr', function () {
			$(this).toggleClass('selected');
			var thisCheck = $(this).find("input[name=id_checkbox]");
			if(thisCheck.prop("checked")) {
				thisCheck.prop("checked", false);
				$("#checkAll").prop("checked",false);
			} else {
				thisCheck.prop("checked", true);
				var cascadeAll = true;
				$("#example").find("input[name='id_checkbox']").each(function(){
					if(!$(this).prop("checked")) {
						cascadeAll = false;
						return;
					}
				});
				if(cascadeAll) {
					$("#checkAll").prop("checked",true);
				}
			}
		});


		$("#checkAll").click(function(){
			var checked = $(this).prop("checked");
			$("#example").find("input[name='id_checkbox']").prop("checked", checked);
			if(checked) {
				$('#example tbody tr').addClass("selected");
			} else {
				$('#example tbody tr').removeClass("selected");
			}
		});

		$("#searchBtn").click(function(){
			roleTable.api()
					.column(1).search($("#roleName").val())
					.column(2).search($("#roleNote").val())
					.draw();
		});

		$("#addBtn").click(function(e){

			roleAddDialog = bootbox.extDialog({
				load:"sys/roleAdd.html",
				title: "弹出框",
				width: 800,
				height: 400,
				buttons: {
					success: {
						label: "Success!",
						className: "btn-success",
						callback: function() {
							//alert($(document.body).height());
							//bootbox.alert("great success");
							/**
							 bootbox.alert("弹出框alert", function(e){
								alert("callback fun");
							});
							 8*/
							Messenger({extraClasses: 'messenger-fixed messenger-on-top'}).post({
								message:"Your request has succeded!",
								hideAfter: 3,
							});
						}
					},
					danger: {
						label: "Danger!",
						className: "btn-danger",
						callback: function() {
							bootbox.prompt("什么？", function(result){
								alert(result);
							});
						}
					},
					main: {
						label: "Click ME!",
						className: "btn-primary",
						callback: function() {
							bootbox.confirm("确认?", function(result){
								alert(result);
							});
						}
					},
					close:{
						label:"保存",
						className:"btn-primary",
						callback: function(e) {
							$("#role_add_form").ajaxSubmit({
								url: "save.do",
								type: "post",
								beforeSubmit: function(formData, jqForm, options) {
									//formData: 数组对象，提交表单时，Form插件会以Ajax方式自动提交这些数据，格式如：[{name:user,value:val },{name:pwd,value:pwd}]
									//jqForm:   jQuery对象，封装了表单的元素
									//options:  options对象
									//var queryString = $.param(formData);   //name=1&address=2
									//var formElement = jqForm[0];         //将jqForm转换为DOM对象
									//var name = formElement.name.value;  //访问jqForm的DOM元素
									var valid = jqForm.validate();
									if(valid) {
										loadingDialog = bootbox.loading("正在提交...");
									}
									return valid;
									//return false;  //只要不返回false，表单都会提交,在这里可以对表单元素进行验证

								},
								timeout: 6000,
								success: function(response, status, xhr){
									bootbox.hide(loadingDialog);
									//alert(response + status + xhr.status);
									Messenger({extraClasses: 'messenger-fixed messenger-on-top'}).post({
										message:"Your request has succeded!",
										hideAfter: 3,
									});
									bootbox.hide(roleAddDialog);
								},
								error : function() {
									bootbox.hide(loadingDialog);
									alert("超时");
								}
							});
							return false;
						}
					}

				}
			});

		});

	});
</script>
